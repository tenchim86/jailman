


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Project Design and Documentation for development">
      
      
        <link rel="canonical" href="https://ornias1993.github.io/jailman/blueprints/nextcloud/">
      
      
        <meta name="author" content="Ornias1993">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.0">
    
    
      
        <title>Nextcloud - JailMan</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.89dc9fe3.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nextcloud" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://ornias1993.github.io/jailman/" title="JailMan" class="md-header-nav__button md-logo" aria-label="JailMan">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            JailMan
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Nextcloud
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/Ornias1993/jailman/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ornias1993/jailman
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Introduction
      </a>
    
  </li>

      
        
      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../bitwarden/" class="md-tabs__link md-tabs__link--active">
          Blueprints
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../migration/v1.1.x%20to%20v1.2.x/" class="md-tabs__link">
          Migration
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://ornias1993.github.io/jailman/" title="JailMan" class="md-nav__button md-logo" aria-label="JailMan">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    JailMan
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/Ornias1993/jailman/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ornias1993/jailman
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../CODE_OF_CONDUCT/" title="Code of Conduct" class="md-nav__link">
      Code of Conduct
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../CONTRIBUTING/" title="Contribution and Review Guidelines" class="md-nav__link">
      Contribution and Review Guidelines
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../config%20options/" title="Config options" class="md-nav__link">
      Config options
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Blueprints
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Blueprints" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Blueprints
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../bitwarden/" title="Bitwarden_RS" class="md-nav__link">
      Bitwarden_RS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../influxdb/" title="InfluxDB" class="md-nav__link">
      InfluxDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../jackett/" title="Jackett" class="md-nav__link">
      Jackett
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kms/" title="Py-KMS" class="md-nav__link">
      Py-KMS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lidarr/" title="Lidarr" class="md-nav__link">
      Lidarr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mariadb/" title="MariaDB" class="md-nav__link">
      MariaDB
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Nextcloud
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="./" title="Nextcloud" class="md-nav__link md-nav__link--active">
      Nextcloud
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#original-readme-from-the-upstream-nextcloud-iocage-install-script" class="md-nav__link">
    Original README from the Upstream Nextcloud-iocage install script:
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../organizr/" title="Organizr" class="md-nav__link">
      Organizr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../plex/" title="Plex" class="md-nav__link">
      Plex
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../radarr/" title="Radarr" class="md-nav__link">
      Radarr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sonarr/" title="Sonarr" class="md-nav__link">
      Sonarr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tautulli/" title="Tautulli" class="md-nav__link">
      Tautulli
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../transmission/" title="Transmission" class="md-nav__link">
      Transmission
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../unifi/" title="Unifi Controller" class="md-nav__link">
      Unifi Controller
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Migration
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Migration" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Migration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../migration/v1.1.x%20to%20v1.2.x/" title="V1.1.x to v1.2.x" class="md-nav__link">
      V1.1.x to v1.2.x
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#original-readme-from-the-upstream-nextcloud-iocage-install-script" class="md-nav__link">
    Original README from the Upstream Nextcloud-iocage install script:
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Ornias1993/jailman/edit/dev/docs/blueprints/nextcloud.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
                  </a>
                
                
                  
                
                
                <h1 id="nextcloud">Nextcloud<a class="headerlink" href="#nextcloud" title="Permanent link">&para;</a></h1>
<h2 id="original-readme-from-the-upstream-nextcloud-iocage-install-script">Original README from the Upstream Nextcloud-iocage install script:<a class="headerlink" href="#original-readme-from-the-upstream-nextcloud-iocage-install-script" title="Permanent link">&para;</a></h2>
<p>https://github.com/danb35/freenas-iocage-nextcloud</p>
<h1 id="freenas-iocage-nextcloud">freenas-iocage-nextcloud<a class="headerlink" href="#freenas-iocage-nextcloud" title="Permanent link">&para;</a></h1>
<p>Script to create an iocage jail on FreeNAS for the latest Nextcloud 18 release, including Caddy 1.0, MariaDB 10.3/PostgreSQL 10, and Let's Encrypt</p>
<p>This script will create an iocage jail on FreeNAS 11.2-U7 or 11.3 with the latest release of Nextcloud 18, along with its dependencies.  It will obtain a trusted certificate from Let's Encrypt for the system, install it, and configure it to renew automatically.  It will create the Nextcloud database and generate a strong root password and user password for the database system.  It will configure the jail to store the database and Nextcloud user data outside the jail, so it will not be lost in the event you need to rebuild the jail.</p>
<h2 id="status">Status<a class="headerlink" href="#status" title="Permanent link">&para;</a></h2>
<p>This script will work with FreeNAS 11.3, and it should also work with 11.2-U7.  Due to the EOL status of FreeBSD 11.2, it is unlikely to work reliably with earlier releases of FreeNAS.</p>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<h3 id="prerequisites-lets-encrypt">Prerequisites (Let's Encrypt)<a class="headerlink" href="#prerequisites-lets-encrypt" title="Permanent link">&para;</a></h3>
<p>This script works best when your installation is able to obtain a certificate from <a href="https://letsencrypt.org/">Let's Encrypt</a>.  When you use it this way, Caddy is able to handle all of the TLS-related configuration for you, obtain and renew certificates automatically, etc.  In order for this to happen, you must meet the two requirements below:</p>
<ul>
<li>
<p>First, you must own or control a real Internet domain name.  This script obtains a TLS encryption certificate from Let's Encrypt, who will only issue for public domain names.  Thus, domains like <code>cloud.local</code>, <code>mycloud.lan</code>, or <code>nextcloud.home</code> won't work.  Domains can be very inexpensive, and in some cases, they can be free.  <a href="https://www.freenom.com/">Freenom</a>, for example, provides domains for free if you jump through the right hoops.  <a href="https://easydns.com/">EasyDNS</a> is a fine domain registrar for paid domains, costing roughly US$15 per year (which varies slightly with the top-level domain).</p>
</li>
<li>
<p>Second, one of these two conditions must be met in order for Let's Encrypt to validate your control over the domain name:</p>
</li>
<li>
<p>You must be able and willing to open ports 80 and 443 from the entire Internet to the jail, and leave them open.  If this applies, do it <strong>before</strong> running this script.</p>
</li>
<li>DNS hosting for the domain name needs to be with a provider that Caddy supports, to automatically update the DNS records needed to prove your control over the domain.  See the <a href="https://caddyserver.com/docs">Caddy documentation</a> under the heading of "DNS Providers" for the supported providers, and what information you'll need in order to proceed.</li>
</ul>
<p><a href="https://www.cloudflare.com/">Cloudflare</a> provides DNS hosting at no cost, and it's well-supported by Caddy.  Cloudflare doesn't directly provide Dynamic DNS service, but <a href="https://dnsomatic.com/">DNS-O-Matic</a> is a Dynamic DNS provider that will interface with many DNS hosts including Cloudflare, and is also free of charge.  So, even if you have a dynamic IP address (as most residential Internet users do), you don't have your own domain, and you aren't willing to pay for a domain or any other relevant service, and you aren't willing to open any ports from the Internet to your system, you can still get a trusted certificate from Let's Encrypt by following these steps:</p>
<ul>
<li>Register a free domain with Freenom.  Be sure to keep up with the renewal requirements.</li>
<li>Sign up for a free account with Cloudflare, and activate it for free DNS service only on your domain.</li>
<li>Tell Freenom to use Cloudflare for DNS for your domain.</li>
<li>Sign up for a free account with DNS-O-Matic, and configure it to update your Cloudflare DNS.</li>
<li>Set up FreeNAS (see <a href="https://www.ixsystems.com/community/threads/dns-o-matic-dynamic-dns-configuration.10326/">this thread</a>), your router, or whatever you prefer to update DNS-O-Matic as your IP address changes.</li>
<li>Set up this script to do DNS validation, tell it to use the cloudflare plugin, and give it your email address and Global API key.</li>
</ul>
<p>If you aren't able or willing to obtain a certificate from Let's Encrypt, this script also supports configuring Caddy with a self-signed certificate, or with no certificate (and thus no HTTPS) at all.</p>
<h3 id="prerequisites-other">Prerequisites (Other)<a class="headerlink" href="#prerequisites-other" title="Permanent link">&para;</a></h3>
<p>Although not required, it's recommended to create two datasets on your main storage pool: one named <code>files</code>, which will store the Nextcloud user data; and one called <code>db</code>, which will store the SQL database.  For optimal performance, set the record size of the <code>db</code> dataset to 16 KB (under Advanced Settings in the FreeNAS web GUI).  It's also recommended to cache only metadata on the <code>db</code> dataset; you can do this by running <code>zfs set primarycache=metadata poolname/db</code>.</p>
<h3 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h3>
<p>Download the repository to a convenient directory on your FreeNAS system by running <code>git clone https://github.com/danb35/freenas-iocage-nextcloud</code>.  Then change into the new directory and create a file called <code>nextcloud-config</code>.  It should look like this:</p>
<div class="codehilite"><pre><span></span><code>JAIL_IP=&quot;192.168.1.199&quot;
DEFAULT_GW_IP=&quot;192.168.1.1&quot;
POOL_PATH=&quot;/mnt/tank&quot;
TIME_ZONE=&quot;America/New_York&quot;
HOST_NAME=&quot;YOUR_FQDN&quot;
STANDALONE_CERT=1
CERT_EMAIL=&quot;me@example.com&quot;
</code></pre></div>


<p>Many of the options are self-explanatory, and all should be adjusted to suit your needs, but only a few are mandatory.  The mandatory options are:</p>
<ul>
<li>JAIL_IP is the IP address for your jail</li>
<li>DEFAULT_GW_IP is the address for your default gateway</li>
<li>POOL_PATH is the path for your data pool.</li>
<li>TIME_ZONE is the time zone of your location, in PHP notation--see the <a href="http://php.net/manual/en/timezones.php">PHP manual</a> for a list of all valid time zones.</li>
<li>HOST_NAME is the fully-qualified domain name you want to assign to your installation.  You must own (or at least control) this domain, because Let's Encrypt will test that control.</li>
<li>DNS_CERT, STANDALONE_CERT, SELFSIGNED_CERT, and NO_CERT determine which method will be used to generate a TLS certificate (or, in the case of NO_CERT, indicate that you don't want to use SSL at all).  DNS_CERT and STANDALONE_CERT indicate use of DNS or HTTP validation for Let's Encrypt, respectively.  One <strong>and only one</strong> of these must be set to 1.</li>
<li>CERT_EMAIL is the email address Let's Encrypt will use to notify you of certificate expiration.  This is mandatory regardless of whether you're using Let's Encrypt (Caddy won't start without it), but it's only used with Let's Encrypt.  If you are <strong>not</strong> using one of the Let's Encrypt certificate options, you can set this to a dummy address as above.  If you <strong>are</strong> using Let's Encrypt, though, it should be set to a valid address for the system admin.</li>
<li>DNS_PLUGIN: If DNS_CERT is set, DNS_PLUGIN must contain the name of the DNS validation plugin you'll use with Caddy to validate domain control.  See the <a href="https://caddyserver.com/docs">Caddy documentation</a> under the heading of "DNS Providers" for the available plugins, but omit the leading "tls.dns.".  For example, to use Cloudflare, set <code>DNS_PLUGIN="cloudflare"</code>.</li>
<li>DNS_ENV: If DNS_CERT is set, DNS_ENV must contain the authentication credentials for your DNS provider.  See the <a href="https://caddyserver.com/docs">Caddy documentation</a> under the heading of "DNS Providers" for further details.  For Cloudflare, you'd set <code>DNS_ENV="CLOUDFLARE_EMAIL=foo@bar.baz CLOUDFLARE_API_KEY=blah"</code>, using your the email address of your Cloudflare account and your Global API key--the newer API tokens aren't currently supported.</li>
</ul>
<p>In addition, there are some other options which have sensible defaults, but can be adjusted if needed.  These are:</p>
<ul>
<li>JAIL_NAME: The name of the jail, defaults to "nextcloud"</li>
<li>DB_PATH, FILES_PATH, and PORTS_PATH: These are the paths to your database files, your data files, and the FreeBSD Ports collection.  They default to $POOL_PATH/db, $POOL_PATH/files, and $POOL_PATH/portsnap, respectively.</li>
<li>DATABASE: Which database management system to use.  Default is "mariadb", but can be set to "pgsql" if you prefer to use PostgreSQL.</li>
<li>INTERFACE: The network interface to use for the jail.  Defaults to <code>vnet0</code>.</li>
<li>VNET: Whether to use the iocage virtual network stack.  Defaults to <code>on</code>.</li>
</ul>
<p>If you're going to open ports 80 and 443 from the outside world to your jail, do so before running the script, and set STANDALONE_CERT to 1.  If not, but you use a DNS provider that's supported by Caddy, set DNS_CERT to 1.  If neither of these is true, you won't be able to use this script without modification.</p>
<p>It's also helpful if HOST_NAME resolves to your jail from <strong>inside</strong> your network.  You'll probably need to configure this on your router.  If it doesn't, you'll still be able to reach your Nextcloud installation via the jail's IP address, but you'll get certificate errors that way.</p>
<h3 id="execution">Execution<a class="headerlink" href="#execution" title="Permanent link">&para;</a></h3>
<p>Once you've downloaded the script and prepared the configuration file, run this script (<code>./nextcloud-jail.sh</code>).  The script will run for several minutes.  When it finishes, your jail will be created, Nextcloud will be installed and configured, and you'll be shown the randomly-generated password for the default user ("admin").  You can then log in and create users, add data, and generally do whatever else you like.</p>
<h3 id="obtaining-a-trusted-lets-encrypt-cert">Obtaining a trusted Let's Encrypt cert<a class="headerlink" href="#obtaining-a-trusted-lets-encrypt-cert" title="Permanent link">&para;</a></h3>
<p>This configuration generated by this script will obtain certs from a non-trusted certificate authority by default.  This is to prevent you from exhausting the <a href="https://letsencrypt.org/docs/rate-limits/">Let's Encrypt rate limits</a> while you're testing things out.  Once you're sure things are working, you'll want to get a trusted cert instead.  To do this, you can use a simple script that's included.  As long as you haven't changed the default jail name, you can do this by running <code>iocage exec nextcloud /root/remove-staging.sh</code>.</p>
<h3 id="to-do">To Do<a class="headerlink" href="#to-do" title="Permanent link">&para;</a></h3>
<p>I'd appreciate any suggestions (or, better yet, pull requests) to improve the various config files I'm using.  Most of them are adapted from the default configuration files that ship with the software in question, and have only been lightly edited to work in this application.  But if there are changes to settings or organization that could improve performance, reliability, or security, I'd like to hear about them.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../mariadb/" title="MariaDB" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                MariaDB
              </div>
            </div>
          </a>
        
        
          <a href="../organizr/" title="Organizr" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Organizr
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.36cbf620.min.js"></script>
      <script src="../../assets/javascripts/bundle.00c583dd.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.7f7c8775.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>